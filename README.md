# 自动化创建虚拟机

## 过程概述

1. 运行vmaker.sh，该脚本会读取当前目录下的kscfg文件
2. 遍历文件每一行，首先判断最后一个参数是否为done，如果为done标明该虚拟机已经创建成功，跳过
3. 判断虚拟机版本号，如果是centos6.x，则调用当前目录下的basic_centos6.sh,如果是centos7.x则调用当前目录下的basic_centos7.sh
4. 会在/tmp/vm_maker_path目录下创建一个临时执行脚本，执行该脚本可创建虚拟机
5. 如果临时执行脚本创建成功，该脚本会自动运行，如果执行成功，会将kscfg对应行的最后一个字段从todo修改为done；如果执行失败，则保留临时脚本，报错退出。
6. 如果临时脚本执行成功，会在当前目录的cmdb_insert.sh脚本增加对应的cmdb归档语句。当kscfg文件所有行最后一个字段都从todo变为done时，标明所有的虚拟机都已经创建成功，可以将cmdb_insert.sh放到可以访问cmdb系统的机器上，执行该脚本

## 输入文件说明

需要在vmaker.sh同级目录下放置一个kscfg文件，每行用空格隔开如下内容：

1.物理机名 2.物理机ip 3.虚拟机名 4.cpu核数 5. 内存(M) 6.系统磁盘空间(G) 7.系统版本 8.ip地址 9.掩码 10.网关 11.密码 12.所属raid 13.所属网段 14.区域 15.实例id 16.todo

例子：

BASIC-SERVER-043    172.23.242.60 vhost.testpf.quality1    4   8192    200 centos6.7   172.27.11.245    255.255.255.0   172.23.27.1 donetodolalala vg0 br27 红山-开发测试 1 done

